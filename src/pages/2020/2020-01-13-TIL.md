---
type: 'post'
title: '2020-01-14 TIL'
date: '2020-01-14'
tags: ['TIL', 'Linux', 'Jenkins']
---

## ë¬¸ì œ í•´ê²°

ì´ˆë³´ ê°œë°œìì˜ ì¢Œì¶©ìš°ëŒ ì„œë²„ ê²½í—˜ê¸°ì…ë‹ˆë‹¤. ğŸ˜­

### Setting Jenkins

```bash
$ sudo apt-get update

# 1. open JDK ì„¤ì¹˜
$ sudo apt-get install openjdk-8-jdk

# 2. Jenkins ì„¤ì¹˜
$ sudo apt-get install jenkins

# 3. Jenkins ì‹œì‘
$ sudo systemctl start jenkins
```

### JAVA_HOME

```bash
$ update-alternatives --display java
java - auto mode
  link best version is /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java
  link currently points to /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java
...
```

`update-alternatives --display java`ë¥¼ ëª…ë ¹ì„ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **link currently points to** ë’¤ì— ìˆëŠ” ì£¼ì†Œê°€ `JAVA_HOME`ì´ì—ìš”.

ì´ì œ ì£¼ì†Œë¥¼ ì•Œì•˜ìœ¼ë‹ˆ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

```bash
$ nano /etc/environment

# /etc/environment
JAVA_HOME="/usr/lib/jvm/java-8-openjdk-amd64"

# environment ì ìš©
$ source /etc/environment
```

### Github + Jenkins

Githubê³¼ jenkinsë¥¼ `ssh` ì—°ë™ ë°©ì‹ì„ í†µí•˜ì—¬ ì—°ë™í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

ìš°ì„  jenkinsê°€ ì„¤ì¹˜ëœ ì„œë²„ì—ì„œ `ssh`ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```bash
$ sudo su -s /bin/bash jenkins
$ ssh-keygen
```

ê·¸ë¦¬ê³  ìƒì„±í•œ í‚¤ ì¤‘ public keyë¥¼ jenkinsë¡œ ì—°ë™í•˜ê³  ì‹¶ì€ githubì˜ repositoryì— ë“±ë¡í•©ë‹ˆë‹¤. `Settings`ì˜ `Deploy keys`ì—ì„œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  private keyëŠ” jenkinsì— ë“±ë¡í•©ë‹ˆë‹¤. `Credentials` ë©”ë‰´ì—ì„œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# public key ì¡°íšŒ
$ cat /var/lib/jenkins/.ssh/[key name].pub

# private key ì¡°íšŒ
$ cat /var/lib/jenkins/.ssh/[key name]
```

ì´í›„ jenkinsì—ì„œ jobì„ ìƒì„±í•  ë•Œì— í•´ë‹¹ í‚¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤! ğŸ˜Š

### Run jar files as service

Jenkinsì™€ gitì„ ì—°ë™í•´ ì„œë²„ì— `jar` íŒŒì¼ì„ ì˜¬ë¦¬ëŠ” ë¶€ë¶„ê¹Œì§€ëŠ” ì–´ì°Œì–´ì°Œ ì„±ê³µ. ì´í›„ `jar` íŒŒì¼ì„ ì–´ë–»ê²Œ ì‹¤í–‰í•  ê²ƒì¸ì§€ ì•Œì•„ë³´ë‹¤ê°€ ìš°ì„  ì„œë²„ì— ì„œë¹„ìŠ¤ë¡œ ë“±ë¡í•˜ëŠ” ë°©ë²•ì„ ì°¾ì•˜ì–´ìš”.

ìš°ì„  ë¦¬ëˆ…ìŠ¤ ì„œë²„ì— ì‚¬ìš©ì ì •ì˜ ì„œë¹„ìŠ¤ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.

```bash
# /etc/systemd/systemì— ë“±ë¡í•  serviceíŒŒì¼ ìƒì„±
$ nano /etc/systemd/system/myapp.service

# myapp.service
[Unit]
Description = my app!
After = network.target

[Service]
ExecStart = /bin/bash -c "exec java -jar [target file]"

User = root
Group = root

[Install]
WantedBy = multi-user.target

# myapp.serviceíŒŒì¼ ì €ì¥ í›„ ì„œë¹„ìŠ¤ë¡œ ë“±ë¡
$ systemctl enable myapp.service

# myapp ì„œë¹„ìŠ¤ ì‹¤í–‰
$ systemctl start myapp
```

ì—¬ê¸°ê¹Œì§€ëŠ” ìˆœì¡°ë¡­ê²Œ ì„±ê³µ. ê·¸ëŸ¬ë‚˜ jenkinsë¡œ ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•˜ë ¤ê³  í•˜ë©´ ê³„ì† `sudo: no tty present and no askpass program specified` ì—ëŸ¬ê°€ ëœ¨ë”ë¼ê³ ìš”. ğŸ¤£ í•´ë‹¹ ì—ëŸ¬ëŠ” `jenkins`ë¼ëŠ” ìœ ì €ì— ê¶Œí•œì´ ë¶€ì—¬ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë¼ê³  í•©ë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ í•´ê²°í–ˆì–´ìš”.

```bash
# /etc/sudoersíŒŒì¼ ìˆ˜ì •
$ nano /etc/sudoers

# /etc/sudoers
...
# Allow members of group sudo to execute any command
%sudo   ALL=(ALL:ALL) ALL
jenkins ALL=(ALL) NOPASSWD: ALL
```

`/etc/sudoers` íŒŒì¼ì— `jenkins ALL=(ALL) NOPASSWD: ALL` ë¬¸êµ¬ë¥¼ ì¶”ê°€í•˜ë©´ í•´ê²°ë©ë‹ˆë‹¤. í•´ë‹¹ ë‚´ìš©ì€ [Jenkins sudo: ~](https://stackoverflow.com/questions/37603621/jenkins-sudo-no-tty-present-and-no-askpass-program-specified-with-nopasswd)ë¥¼ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤.

### Linux Commands

`apt`

```bash
# repository index ê°±ì‹ 
$ sudo apt-get update

# package upgrade
$ sudo apt-get upgrade

# auto remove package
$ sudo apt-get autoremove

# install package
$ sudo apt-get install [package name]

# remove package
$ sudo apt-get remove [package name]
```
