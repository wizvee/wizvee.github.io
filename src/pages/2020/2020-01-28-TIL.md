---
# type: 'post'
title: '2020-01-28 TIL'
date: '2020-01-28'
tags: ['Spring']
---

## Spring Web MVC

Spring Web MVC는 서블릿 API를 기반으로 한 오리지널 웹 프레임워크이며, 처음부터 스프링 프레임워크에 포함되어 있습니다.

### HttpMessageConverters

`@RestController` 어노테이션을 사용했다면 메서드의 return에는 암시적으로 `@ResponseBody` 어노테이션이 붙은 것으로 취급된다. 때문에 `@Controller` 어노테이션에 메시지 컨버터를 적용하려면 return에 `@ResponseBody`를 적어줘야 한다.

컴포지션 타입(안에 여러 프로퍼티를 가짐)을 리턴할 경우에는 jsonMessageConverter를 사용하고, 단순 String, int형일 경우 StringMessageConverter를 사용한다.

### ViewResolver

### Static Content

기본 resource 위치는 아래

- classpath:/static
- classpath:/public
- classpath:/resources/
- classpath:/META-INF/resources

위는 `/**` 맵핑이 가능, 또한 위 위치에 `index` 페이지를 추가하면 웰컴 페이지가 됨.

이런 식으로 정적 자원을 추가할 수 있음.

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/m/**")
                .addResourceLocations("classpath:/m/")
                .setCachePeriod(20);
    }
}
```

### Thymeleaf

템플릿 엔진은 여러 가지 용도로 사용할 수 있음. 코드 제너레이션, 이메일 템플릿 등등. 다만 주요한 목적은 뷰를 만들 때 사용.

JSP는 war 패키징 기반이므로 spring boot와 근본적으로 지향하는 바가 다름. 또한 JSP는 servelt engin이 view를 구현했기 때문에 WAS를 구동하지 않고는 JSP를 확인할 수 없었음.

Thymeleaf는 독자적으로 최종 view를 완성. 실제로 servlet container를 띄우지 않고도 확인이 가능.

Thymeleaf를 사용하기 위해서는 `html` 문서에 `xml`을 추가해야 함.

```html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Thymeleaf</title>
  </head>
  <body>
    <h1 th:text="${name}">name</h1>
  </body>
</html>
```

### ExceptionHandler

MVC 중 controller에서 예외 처리를 하고 싶다면 `@ExceptionHandler`를 사용하면 된다.

```java
@ExceptionHandler(SampleException.class)
public AppErr sampleErr(SampleException e) {
    AppErr appErr = new AppErr();
    appErr.setMessage("ERROR");
    return appErr;
}
```

커스텀 에러 페이지를 만들고 싶다면, `src/main/resources/static|template/error` 디렉터리에 각 상태 코드 이름으로 페이지를 만든다.

### Spring HATEOAS

`Resource`가 `EntityModel`로 바뀜.
https://docs.spring.io/spring-hateoas/docs/current/reference/html/
